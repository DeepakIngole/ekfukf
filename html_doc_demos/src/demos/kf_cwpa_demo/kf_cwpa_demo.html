<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of kf_cwpa_demo</title>
  <meta name="keywords" content="kf_cwpa_demo">
  <meta name="description" content="Demonstration for Kalman filter and smoother using a 2D CWPA model">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">src</a> &gt; <a href="#">demos</a> &gt; <a href="index.html">kf_cwpa_demo</a> &gt; kf_cwpa_demo.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src/demos/kf_cwpa_demo&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>kf_cwpa_demo
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>Demonstration for Kalman filter and smoother using a 2D CWPA model</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function kf_cwpa_demo </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Demonstration for Kalman filter and smoother using a 2D CWPA model

 Copyright (C) 2007 Jouni Hartikainen

 This software is distributed under the GNU General Public 
 Licence (version 2 or later); please refer to the file 
 Licence.txt, included with the software, for details.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% Demonstration for Kalman filter and smoother using a 2D CWPA model</span>
0002 <span class="comment">%</span>
0003 <span class="comment">% Copyright (C) 2007 Jouni Hartikainen</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% This software is distributed under the GNU General Public</span>
0006 <span class="comment">% Licence (version 2 or later); please refer to the file</span>
0007 <span class="comment">% Licence.txt, included with the software, for details.</span>
0008 
0009 <a name="_sub0" href="#_subfunctions" class="code">function kf_cwpa_demo</a>
0010 
0011 <span class="comment">% Transition matrix for the continous-time system.</span>
0012 F = [0 0 1 0 0 0;
0013      0 0 0 1 0 0;
0014      0 0 0 0 1 0;
0015      0 0 0 0 0 1;
0016      0 0 0 0 0 0;
0017      0 0 0 0 0 0];
0018 
0019 <span class="comment">% Noise effect matrix for the continous-time system.</span>
0020 L = [0 0;
0021      0 0;
0022      0 0;
0023      0 0;
0024      1 0;
0025      0 1];
0026 
0027 <span class="comment">% Stepsize</span>
0028 dt = 0.5;
0029 
0030 <span class="comment">% Process noise variance</span>
0031 q = 0.2;
0032 Qc = diag([q q]);
0033 
0034 <span class="comment">% Discretization of the continous-time system.</span>
0035 [A,Q] = lti_disc(F,L,Qc,dt);
0036 
0037 <span class="comment">% Measurement model.</span>
0038 H = [1 0 0 0 0 0;
0039      0 1 0 0 0 0];
0040 
0041 <span class="comment">% Variance in the measurements.</span>
0042 r1 = 10;
0043 r2 = 5;
0044 R = diag([r1 r1]);
0045 
0046 <span class="comment">% Generate the data.</span>
0047 n = 50;
0048 Y = zeros(size(H,1),n);
0049 X_r = zeros(size(F,1),n);
0050 X_r(:,1) = [0 0 0 0 0 0]';
0051 <span class="keyword">for</span> i = 2:n
0052    X_r(:,i) = A*X_r(:,i-1) + gauss_rnd(zeros(size(F,1),1), Q);
0053 <span class="keyword">end</span>
0054 
0055 <span class="comment">% Generate the measurements.</span>
0056 <span class="keyword">for</span> i = 1:n
0057    Y(:,i) = H*X_r(:,i) + gauss_rnd(zeros(size(Y,1),1), R);
0058 <span class="keyword">end</span>
0059 
0060 clf; clc;
0061 disp(<span class="string">'This is a demonstration program for the classical Kalman filter.'</span>);
0062 disp(<span class="string">' '</span>);
0063 disp([<span class="string">'KF is used here to estimate the position of a moving object, whos '</span>,<span class="keyword">...</span>
0064      <span class="string">'dynamics follow the CWPA-model described in the documentation '</span>,<span class="keyword">...</span>
0065       <span class="string">'provided with the toolbox.'</span>]);
0066 disp(<span class="string">' '</span>);
0067 disp([<span class="string">'We get noisy measurements from the objects position and velocity '</span>,<span class="keyword">...</span>
0068       <span class="string">'on discrete time steps. The real position of the object and the '</span>,<span class="keyword">...</span>
0069       <span class="string">'measurements made of them are displayed now. The blue line is the '</span>,<span class="keyword">...</span>
0070       <span class="string">'real path of the object and the green dots represents the '</span>,<span class="keyword">...</span>
0071       <span class="string">'measurements. The red circle represents the starting point '</span>,<span class="keyword">...</span>
0072       <span class="string">'of the object.'</span>]);
0073 
0074 disp(<span class="string">' '</span>);
0075 fprintf(<span class="string">'Filtering with KF...'</span>);
0076 
0077 plot(X_r(1,:),X_r(2,:),Y(1,:),Y(2,:),<span class="string">'.'</span>,X_r(1,1),<span class="keyword">...</span>
0078      X_r(2,1),<span class="string">'ro'</span>,<span class="string">'MarkerSize'</span>,12);
0079 legend(<span class="string">'Real trajectory'</span>, <span class="string">'Measurements'</span>);
0080 title(<span class="string">'Position'</span>);
0081 
0082 <span class="comment">% Uncomment if you want to save an image</span>
0083 <span class="comment">% print -dpsc demo1_f1.ps</span>
0084 
0085 <span class="comment">% Initial guesses for the state mean and covariance.</span>
0086 m = [0 0 0 0 0 0]';
0087 P = diag([0.1 0.1 0.1 0.1 0.5 0.5]);
0088 
0089 <span class="comment">%% Space for the estimates.</span>
0090 MM = zeros(size(m,1), size(Y,2));
0091 PP = zeros(size(m,1), size(m,1), size(Y,2));
0092 
0093 <span class="comment">% Filtering steps.</span>
0094 <span class="keyword">for</span> i = 1:size(Y,2)
0095    [m,P] = kf_predict(m,P,A,Q);
0096    [m,P] = kf_update(m,P,Y(:,i),H,R);
0097    MM(:,i) = m;
0098    PP(:,:,i) = P;
0099 <span class="keyword">end</span>
0100 
0101 <span class="comment">% Smoothing step.</span>
0102 [SM,SP] = rts_smooth(MM,PP,A,Q);
0103 [SM2,SP2] = tf_smooth(MM,PP,Y,A,Q,H,R,1);
0104 
0105 fprintf(<span class="string">'ready.\n'</span>);
0106 disp(<span class="string">' '</span>);
0107 disp(<span class="string">'&lt;push any button to see the results&gt;'</span>);
0108 pause
0109 
0110 subplot(1,2,1);
0111 plot(X_r(1,:), X_r(2,:),<span class="string">'--'</span>, MM(1,:), MM(2,:),X_r(1,1),X_r(2,1),<span class="keyword">...</span>
0112      <span class="string">'o'</span>,<span class="string">'MarkerSize'</span>,12)
0113 legend(<span class="string">'Real trajectory'</span>, <span class="string">'Filtered'</span>);
0114 title(<span class="string">'Position estimation with Kalman filter.'</span>);
0115 xlabel(<span class="string">'x'</span>);
0116 ylabel(<span class="string">'y'</span>);
0117 
0118 subplot(1,2,2);
0119 plot(X_r(3,:), X_r(4,:),<span class="string">'--'</span>, MM(3,:), MM(4,:),X_r(3,1),<span class="keyword">...</span>
0120      X_r(4,1),<span class="string">'ro'</span>,<span class="string">'MarkerSize'</span>,12);
0121 legend(<span class="string">'Real velocity'</span>, <span class="string">'Filtered'</span>);
0122 title(<span class="string">'Velocity estimation with Kalman filter.'</span>);
0123 xlabel(<span class="string">'x^.'</span>);
0124 ylabel(<span class="string">'y^.'</span>);
0125 
0126 <span class="comment">% Uncomment if you want to save an image</span>
0127 <span class="comment">% print -dpsc demo1_f2.ps</span>
0128 
0129 
0130 clc; 
0131 disp([<span class="string">'The filtering results are displayed now. In the left panel the '</span>,<span class="keyword">...</span>
0132       <span class="string">'estimated path is shown, and, for comparison, in the right panel '</span>,<span class="keyword">...</span>
0133       <span class="string">'the estimated velocity is shown.'</span>]);
0134 disp(<span class="string">' '</span>)
0135 disp(<span class="string">'&lt;push any key to see the smoothing results of a RTS smoother&gt;'</span>);
0136 
0137 pause
0138 subplot(1,2,1);
0139 plot(X_r(1,:), X_r(2,:),<span class="string">'--'</span>, SM(1,:), SM(2,:),X_r(1,1),<span class="keyword">...</span>
0140      X_r(2,1),<span class="string">'ro'</span>,<span class="string">'MarkerSize'</span>,12);
0141 legend(<span class="string">'Real trajectory'</span>, <span class="string">'Smoothed'</span>);
0142 title(<span class="string">'Position estimation with RTS smoother.'</span>);
0143 xlabel(<span class="string">'x'</span>);
0144 ylabel(<span class="string">'y'</span>);
0145 
0146 subplot(1,2,2);
0147 plot(X_r(3,:), X_r(4,:),<span class="string">'--'</span>, SM(3,:), SM(4,:),X_r(3,1),<span class="keyword">...</span>
0148      X_r(4,1),<span class="string">'ro'</span>,<span class="string">'MarkerSize'</span>,12);
0149 legend(<span class="string">'Real velocity'</span>, <span class="string">'Smoothed'</span>);
0150 title(<span class="string">'Velocity estimation with RTS smoother.'</span>);
0151 xlabel(<span class="string">'x^.'</span>);
0152 ylabel(<span class="string">'y^.'</span>);
0153 
0154 <span class="comment">% Uncomment if you want to save an image</span>
0155 <span class="comment">% print -dpsc demo1_f3.ps</span>
0156 
0157 clc; 
0158 disp([<span class="string">'The smoothing results are displayed now. In the left panel the '</span>,<span class="keyword">...</span>
0159       <span class="string">'estimated path is shown, and, for comparison, in the right panel '</span>,<span class="keyword">...</span>
0160       <span class="string">'the estimated velocity is shown.'</span>]);
0161 disp(<span class="string">' '</span>)
0162 disp(<span class="string">'&lt;push any key to see the filtering results sequentially&gt;'</span>);
0163 
0164 pause
0165 subplot(1,2,1);
0166 plot(X_r(1,:), X_r(2,:),<span class="string">'--'</span>, SM2(1,:), SM2(2,:),X_r(1,1),<span class="keyword">...</span>
0167      X_r(2,1),<span class="string">'ro'</span>,<span class="string">'MarkerSize'</span>,12);
0168 legend(<span class="string">'Real trajectory'</span>, <span class="string">'Smoothed'</span>);
0169 title(<span class="string">'Position estimation with TF smoother.'</span>);
0170 xlabel(<span class="string">'x'</span>);
0171 ylabel(<span class="string">'y'</span>);
0172 
0173 subplot(1,2,2);
0174 plot(X_r(3,:), X_r(4,:),<span class="string">'--'</span>, SM2(3,:), SM2(4,:),X_r(3,1),<span class="keyword">...</span>
0175      X_r(4,1),<span class="string">'ro'</span>,<span class="string">'MarkerSize'</span>,12);
0176 legend(<span class="string">'Real velocity'</span>, <span class="string">'Smoothed'</span>);
0177 title(<span class="string">'Velocity estimation with TF smoother.'</span>);
0178 xlabel(<span class="string">'x^.'</span>);
0179 ylabel(<span class="string">'y^.'</span>);
0180 
0181 <span class="comment">% Track and animate the filtering result.</span>
0182 clc
0183 disp([<span class="string">'Filtering result is now displayed sequentially on '</span>,<span class="keyword">...</span>
0184      <span class="string">'every time step.'</span>]);
0185 disp(<span class="string">' '</span>);
0186 disp([<span class="string">'The observations are displayed as green dots and '</span>,<span class="keyword">...</span>
0187      <span class="string">'the real signal as solid blue line. The filtering '</span>,<span class="keyword">...</span>
0188      <span class="string">'result of previous steps is plotted as dashed black '</span>,<span class="keyword">...</span>
0189      <span class="string">'line. The covariance in each step is displayed as a '</span>,<span class="keyword">...</span>
0190      <span class="string">'green ellipse around the mean (black circle) on each '</span>,<span class="keyword">...</span>
0191      <span class="string">'step. The predicted position on next step is displayed '</span>,<span class="keyword">...</span>
0192      <span class="string">'as a red circle'</span>]);
0193 disp(<span class="string">' '</span>);
0194 disp(<span class="string">'&lt;push any key to proceed to next step&gt;'</span>);
0195 
0196 clf
0197 EST = [];
0198 <span class="keyword">for</span> k=1:size(Y,2)
0199     M = MM(:,k);  
0200     P = PP(:,:,k);
0201     EST = [EST M];
0202     M_pred = kf_predict(M,P,A,Q);
0203     
0204     <span class="comment">% Confidence ellipse</span>
0205     tt = (0:0.01:1)*2*pi;
0206     cc = repmat(M(1:2),1,length(tt)) + <span class="keyword">...</span>
0207      2*chol(P(1:2,1:2))'*[cos(tt);sin(tt)];
0208 
0209     <span class="comment">% Animate</span>
0210     plot(X_r(1,:),X_r(2,:),<span class="string">'-'</span>,<span class="keyword">...</span>
0211          Y(1,:), Y(2,:), <span class="string">'.'</span>,<span class="keyword">...</span>
0212          M(1),M(2),<span class="string">'ko'</span>,<span class="keyword">...</span>
0213          M_pred(1),M_pred(2),<span class="string">'ro'</span>,<span class="keyword">...</span>
0214          EST(1,:),EST(2,:),<span class="string">'k--'</span>,<span class="keyword">...</span>
0215      cc(1,:),cc(2,:),<span class="string">'g-'</span>);
0216     drawnow;
0217     pause;
0218 <span class="keyword">end</span>
0219 
0220 <span class="comment">% Smoothing result.</span>
0221 clf; clc;
0222 disp([<span class="string">'Smoothing (using RTS smoother) result is now displayed '</span>,<span class="keyword">...</span>
0223      <span class="string">'sequentially on every time step in reverse order.'</span>]);
0224 disp(<span class="string">' '</span>);
0225 disp([<span class="string">'The observations are displayed as green dots and the '</span>,<span class="keyword">...</span>
0226      <span class="string">'real signal as solid blue line. The smoothing result '</span>,<span class="keyword">...</span>
0227      <span class="string">'of previous steps is plotted as dashed black line.'</span>,<span class="keyword">...</span>
0228      <span class="string">'The covariance in each step is displayed as a green'</span>,<span class="keyword">...</span>
0229      <span class="string">'ellipse around the mean (black circle) on each step.'</span>]);
0230 disp(<span class="string">' '</span>);
0231 disp(<span class="string">'&lt;push any key to proceed to next step&gt;'</span>);
0232 
0233 EST = [];
0234 <span class="keyword">for</span> k=size(Y,2):-1:1
0235     M = SM(:,k);  
0236     P = SP(:,:,k);
0237     EST = [EST M];
0238 
0239     <span class="comment">% Confidence ellipse</span>
0240     tt = (0:0.01:1)*2*pi;
0241     cc = repmat(M(1:2),1,length(tt)) + <span class="keyword">...</span>
0242      2*chol(P(1:2,1:2))'*[cos(tt);sin(tt)];
0243 
0244     <span class="comment">% Animate</span>
0245     len = 1.5;
0246     plot(X_r(1,:),X_r(2,:),<span class="string">'-'</span>,<span class="keyword">...</span>
0247          Y(1,:),Y(2,:),<span class="string">'.'</span>,<span class="keyword">...</span><span class="comment">         </span>
0248          M(1),M(2),<span class="string">'ko'</span>,<span class="keyword">...</span>
0249          EST(1,:),EST(2,:),<span class="string">'k--'</span>,<span class="keyword">...</span>
0250      cc(1,:),cc(2,:),<span class="string">'g-'</span>);
0251     drawnow;
0252     pause;
0253 <span class="keyword">end</span>
0254 
0255 <span class="comment">% MSEs of position estimates</span>
0256 MSE_KF1 = mean((X_r(1,:)-MM(1,:)).^2);
0257 MSE_KF2 = mean((X_r(2,:)-MM(2,:)).^2);
0258 MSE_KF = 1/2*(MSE_KF1 + MSE_KF2);
0259 
0260 MSE_RTS1 = mean((X_r(1,:)-SM(1,:)).^2);
0261 MSE_RTS2 = mean((X_r(2,:)-SM(2,:)).^2);
0262 MSE_RTS = 1/2*(MSE_RTS1 + MSE_RTS2);
0263 
0264 MSE_TF1 = mean((X_r(1,:)-SM2(1,:)).^2);
0265 MSE_TF2 = mean((X_r(2,:)-SM2(2,:)).^2);
0266 MSE_TF = 1/2*(MSE_TF1 + MSE_TF2);
0267 
0268 clc;
0269 fprintf(<span class="string">'Mean square errors of position estimates:\n'</span>);
0270 fprintf(<span class="string">'KF-RMSE = %.4f\n'</span>,MSE_KF);
0271 fprintf(<span class="string">'RTS-RMSE = %.4f\n'</span>,MSE_RTS);
0272 fprintf(<span class="string">'TF-RMSE = %.4f\n\n'</span>,MSE_TF);
0273 
0274</pre></div>
<hr><address>Generated on Mon 06-Aug-2007 15:19:02 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>