<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of rk4</title>
  <meta name="keywords" content="rk4">
  <meta name="description" content="RK4  4th order Runge-Kutta integration">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">src</a> &gt; rk4.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>rk4
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>RK4  4th order Runge-Kutta integration</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [x,Y] = rk4(f,dt,x,P1,P2,P3,Y) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">RK4  4th order Runge-Kutta integration

 Syntax:
   [x,Y] = rk4(f,dt,x,[P1,P2,P3,Y])

 In:
    f - Name of function in form f(x,P(:)) or
        inline function taking the same parameters.
        In chained case the function should be f(x,y,P(:)).
   dt - Delta time as scalar.
    x - Value of x from the previous time step.
   P1 - Values of parameters of the function at initial time t
        as a cell array (or single plain value). Defaults to empty
        array (no parameters).
   P2 - Values of parameters of the function at time t+dt/2 as
        a cell array (or single plain value). Defaults to P1 and
        each empty (or missing) value in the cell array is replaced
        with the corresponding value in P1.
   P3 - Values of parameters of the function at time t+dt.
        Defaults to P2 similarly to above.
    Y - Cell array of partial results y1,y2,y3,y4 in the RK algorithm
        of the second parameter in the interated function. This can be
        used for chaining the integrators. Defaults to empty.
 
 Out:
    x - Next value of X
    Y - Cell array of partial results in Runge-Kutta algorithm.

 Description:
   Perform one fourth order Runge-Kutta iteration step
   for differential equation

       dx/dt = f(x(t),P{:})

   or in the chained case

       dx/dt = f(x(t),y(t),P{:})
       dy/dt = g(y(t),P{:})

   - Example 1. Simple integration of model

       dx/dt = tanh(x), x(0) = 1

     can be done as follows:

       X = [];
       x = 1;
       f = inline('tanh(x)','x');
       for i=1:100
         x = rk4(f,0.1,x);
         X = [X x];
       end

   - Example 2. Chaining of integrators. Consider a
     model of the form

       dx/dt = x+y,     x(0)=1
       dy/dt = tanh(y), y(0)=2

     The equations can be now integrated as follows:

       XY = [];
       x = 1;
       y = 2;
       fx = inline('x+y','x','y');
       fy = inline('tanh(y)','y');
       for i=1:100
         [y,YY] = rk4(fy,0.1,y);
         x = rk4(fx,0.1,x,{},{},{},YY);
         XY = [XY [x;y]];
       end

   which produces exactly the same result as

      XY = [];
      xy = [1;2];
      fxy = inline('[xy(1)+xy(2);tanh(xy(2))]','xy');
      for i=1:100
         xy = rk4(fxy,0.1,xy);
         XY = [XY xy];
      end

   This deterministic RK4-integrator can be chained with
   the stochastic RK4-integrator.

 Author:
   Simo Särkkä, 2005</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%RK4  4th order Runge-Kutta integration</span>
0002 <span class="comment">%</span>
0003 <span class="comment">% Syntax:</span>
0004 <span class="comment">%   [x,Y] = rk4(f,dt,x,[P1,P2,P3,Y])</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% In:</span>
0007 <span class="comment">%    f - Name of function in form f(x,P(:)) or</span>
0008 <span class="comment">%        inline function taking the same parameters.</span>
0009 <span class="comment">%        In chained case the function should be f(x,y,P(:)).</span>
0010 <span class="comment">%   dt - Delta time as scalar.</span>
0011 <span class="comment">%    x - Value of x from the previous time step.</span>
0012 <span class="comment">%   P1 - Values of parameters of the function at initial time t</span>
0013 <span class="comment">%        as a cell array (or single plain value). Defaults to empty</span>
0014 <span class="comment">%        array (no parameters).</span>
0015 <span class="comment">%   P2 - Values of parameters of the function at time t+dt/2 as</span>
0016 <span class="comment">%        a cell array (or single plain value). Defaults to P1 and</span>
0017 <span class="comment">%        each empty (or missing) value in the cell array is replaced</span>
0018 <span class="comment">%        with the corresponding value in P1.</span>
0019 <span class="comment">%   P3 - Values of parameters of the function at time t+dt.</span>
0020 <span class="comment">%        Defaults to P2 similarly to above.</span>
0021 <span class="comment">%    Y - Cell array of partial results y1,y2,y3,y4 in the RK algorithm</span>
0022 <span class="comment">%        of the second parameter in the interated function. This can be</span>
0023 <span class="comment">%        used for chaining the integrators. Defaults to empty.</span>
0024 <span class="comment">%</span>
0025 <span class="comment">% Out:</span>
0026 <span class="comment">%    x - Next value of X</span>
0027 <span class="comment">%    Y - Cell array of partial results in Runge-Kutta algorithm.</span>
0028 <span class="comment">%</span>
0029 <span class="comment">% Description:</span>
0030 <span class="comment">%   Perform one fourth order Runge-Kutta iteration step</span>
0031 <span class="comment">%   for differential equation</span>
0032 <span class="comment">%</span>
0033 <span class="comment">%       dx/dt = f(x(t),P{:})</span>
0034 <span class="comment">%</span>
0035 <span class="comment">%   or in the chained case</span>
0036 <span class="comment">%</span>
0037 <span class="comment">%       dx/dt = f(x(t),y(t),P{:})</span>
0038 <span class="comment">%       dy/dt = g(y(t),P{:})</span>
0039 <span class="comment">%</span>
0040 <span class="comment">%   - Example 1. Simple integration of model</span>
0041 <span class="comment">%</span>
0042 <span class="comment">%       dx/dt = tanh(x), x(0) = 1</span>
0043 <span class="comment">%</span>
0044 <span class="comment">%     can be done as follows:</span>
0045 <span class="comment">%</span>
0046 <span class="comment">%       X = [];</span>
0047 <span class="comment">%       x = 1;</span>
0048 <span class="comment">%       f = inline('tanh(x)','x');</span>
0049 <span class="comment">%       for i=1:100</span>
0050 <span class="comment">%         x = rk4(f,0.1,x);</span>
0051 <span class="comment">%         X = [X x];</span>
0052 <span class="comment">%       end</span>
0053 <span class="comment">%</span>
0054 <span class="comment">%   - Example 2. Chaining of integrators. Consider a</span>
0055 <span class="comment">%     model of the form</span>
0056 <span class="comment">%</span>
0057 <span class="comment">%       dx/dt = x+y,     x(0)=1</span>
0058 <span class="comment">%       dy/dt = tanh(y), y(0)=2</span>
0059 <span class="comment">%</span>
0060 <span class="comment">%     The equations can be now integrated as follows:</span>
0061 <span class="comment">%</span>
0062 <span class="comment">%       XY = [];</span>
0063 <span class="comment">%       x = 1;</span>
0064 <span class="comment">%       y = 2;</span>
0065 <span class="comment">%       fx = inline('x+y','x','y');</span>
0066 <span class="comment">%       fy = inline('tanh(y)','y');</span>
0067 <span class="comment">%       for i=1:100</span>
0068 <span class="comment">%         [y,YY] = rk4(fy,0.1,y);</span>
0069 <span class="comment">%         x = rk4(fx,0.1,x,{},{},{},YY);</span>
0070 <span class="comment">%         XY = [XY [x;y]];</span>
0071 <span class="comment">%       end</span>
0072 <span class="comment">%</span>
0073 <span class="comment">%   which produces exactly the same result as</span>
0074 <span class="comment">%</span>
0075 <span class="comment">%      XY = [];</span>
0076 <span class="comment">%      xy = [1;2];</span>
0077 <span class="comment">%      fxy = inline('[xy(1)+xy(2);tanh(xy(2))]','xy');</span>
0078 <span class="comment">%      for i=1:100</span>
0079 <span class="comment">%         xy = rk4(fxy,0.1,xy);</span>
0080 <span class="comment">%         XY = [XY xy];</span>
0081 <span class="comment">%      end</span>
0082 <span class="comment">%</span>
0083 <span class="comment">%   This deterministic RK4-integrator can be chained with</span>
0084 <span class="comment">%   the stochastic RK4-integrator.</span>
0085 <span class="comment">%</span>
0086 <span class="comment">% Author:</span>
0087 <span class="comment">%   Simo Särkkä, 2005</span>
0088 
0089 <span class="comment">% History:</span>
0090 <span class="comment">%   14.10.2005  The first official version.</span>
0091 <span class="comment">%</span>
0092 <span class="comment">% Copyright (C) 2005 Simo Särkkä</span>
0093 <span class="comment">%</span>
0094 <span class="comment">% $Id: rk4.m,v 1.1 2006/03/01 16:56:44 ssarkka Exp $</span>
0095 <span class="comment">%</span>
0096 <span class="comment">% This software is distributed under the GNU General Public</span>
0097 <span class="comment">% Licence (version 2 or later); please refer to the file</span>
0098 <span class="comment">% Licence.txt, included with the software, for details.</span>
0099 
0100 <a name="_sub0" href="#_subfunctions" class="code">function [x,Y] = rk4(f,dt,x,P1,P2,P3,Y)</a>
0101 
0102   <span class="comment">%</span>
0103   <span class="comment">% Apply default parameter values</span>
0104   <span class="comment">%</span>
0105   <span class="keyword">if</span> nargin &lt; 4
0106     P1 = {};
0107   <span class="keyword">end</span>
0108   <span class="keyword">if</span> nargin &lt; 5
0109     P2 = {};
0110   <span class="keyword">end</span>
0111   <span class="keyword">if</span> nargin &lt; 6
0112     P3 = {};
0113   <span class="keyword">end</span>
0114   <span class="keyword">if</span> nargin &lt; 7
0115     Y = {};
0116   <span class="keyword">end</span>
0117   
0118   <span class="keyword">if</span> ~isempty(P1) &amp; ~iscell(P1)
0119     P1 = {P1};
0120   <span class="keyword">end</span>
0121   <span class="keyword">if</span> ~isempty(P2) &amp; ~iscell(P2)
0122     P2 = {P2};
0123   <span class="keyword">end</span>
0124   <span class="keyword">if</span> ~isempty(P3) &amp; ~iscell(P3)
0125     P3 = {P3};
0126   <span class="keyword">end</span>
0127   
0128   <span class="keyword">if</span> isempty(P2)
0129     P2 = P1;
0130   <span class="keyword">else</span>
0131     <span class="keyword">for</span> i=1:length(P1)
0132       <span class="keyword">if</span> length(P2) &gt;= i
0133     <span class="keyword">if</span> isempty(P2{i})
0134       P2{i} = P1{i};
0135     <span class="keyword">end</span>
0136       <span class="keyword">else</span>
0137     P2{i} = P1{i};
0138       <span class="keyword">end</span>
0139     <span class="keyword">end</span>
0140   <span class="keyword">end</span>
0141   <span class="keyword">if</span> isempty(P3)
0142     P3 = P2;
0143   <span class="keyword">else</span>
0144     <span class="keyword">for</span> i=1:length(P2)
0145       <span class="keyword">if</span> length(P3) &gt;= i
0146     <span class="keyword">if</span> isempty(P3{i})
0147       P3{i} = P2{i};
0148     <span class="keyword">end</span>
0149       <span class="keyword">else</span>
0150     P3{i} = P2{i};
0151       <span class="keyword">end</span>
0152     <span class="keyword">end</span>
0153   <span class="keyword">end</span>
0154 
0155   <span class="comment">%</span>
0156   <span class="comment">% Perform Runge-Kutta step</span>
0157   <span class="comment">%</span>
0158   <span class="keyword">if</span> ~isempty(Y)
0159     <span class="comment">%</span>
0160     <span class="comment">% Chained integration</span>
0161     <span class="comment">%</span>
0162     <span class="keyword">if</span> isstr(f) | strcmp(class(f),<span class="string">'function_handle'</span>)
0163       x1  = x;
0164       dx1 = feval(f,x1,Y{1},P1{:}) * dt;
0165       x2  = x+0.5*dx1;
0166       dx2 = feval(f,x2,Y{2},P2{:}) * dt;
0167       x3  = x+0.5*dx2;
0168       dx3 = feval(f,x3,Y{3},P2{:}) * dt;
0169       x4  = x+dx3;
0170       dx4 = feval(f,x4,Y{4},P3{:}) * dt;
0171     <span class="keyword">else</span>
0172       x1  = x;
0173       dx1 = f(x1,Y{1},P1{:}) * dt;
0174       x2  = x+0.5*dx1;
0175       dx2 = f(x2,Y{2},P2{:}) * dt;
0176       x3  = x+0.5*dx2;
0177       dx3 = f(x3,Y{3},P2{:}) * dt;
0178       x4  = x+dx3;
0179       dx4 = f(x4,Y{4},P3{:}) * dt;
0180     <span class="keyword">end</span>  
0181   <span class="keyword">else</span>
0182     <span class="keyword">if</span> isstr(f) | strcmp(class(f),<span class="string">'function_handle'</span>)
0183       x1  = x;
0184       dx1 = feval(f,x1,P1{:}) * dt;
0185       x2  = x+0.5*dx1;
0186       dx2 = feval(f,x2,P2{:}) * dt;
0187       x3  = x+0.5*dx2;
0188       dx3 = feval(f,x3,P2{:}) * dt;
0189       x4  = x+dx3;
0190       dx4 = feval(f,x4,P3{:}) * dt;
0191     <span class="keyword">else</span>
0192       x1  = x;
0193       dx1 = f(x1,P1{:}) * dt;
0194       x2  = x+0.5*dx1;
0195       dx2 = f(x2,P2{:}) * dt;
0196       x3  = x+0.5*dx2;
0197       dx3 = f(x3,P2{:}) * dt;
0198       x4  = x+dx3;
0199       dx4 = f(x4,P3{:}) * dt;
0200     <span class="keyword">end</span>
0201   <span class="keyword">end</span>
0202 
0203   Y = {x1,x2,x3,x4};
0204   x = x + 1/6 * (dx1 + 2*dx2 + 2*dx3 + dx4);</pre></div>
<hr><address>Generated on Thu 07-Jun-2007 14:54:42 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>