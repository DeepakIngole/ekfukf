<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of dreentry_demo</title>
  <meta name="keywords" content="dreentry_demo">
  <meta name="description" content="Discrete-time reentry demonstration using EKF and UKF.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">src</a> &gt; <a href="#">demos</a> &gt; <a href="index.html">dreentry_demo</a> &gt; dreentry_demo.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src/demos/dreentry_demo&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>dreentry_demo
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>Discrete-time reentry demonstration using EKF and UKF.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Discrete-time reentry demonstration using EKF and UKF.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="dreentry_a.html" class="code" title="function x = dreentry_a(xw,param)">dreentry_a</a>	Dynamical model for reentry problem</li><li><a href="dreentry_da.html" class="code" title="function da = dreentry_da(x,param)">dreentry_da</a>	da = dreentry_da(x,param)</li><li><a href="dreentry_dh.html" class="code" title="function dy = dreentry_dh(x,param)">dreentry_dh</a>	dy = dreentry_dh(x,param)</li><li><a href="dreentry_h.html" class="code" title="function y = dreentry_h2(x,param)">dreentry_h</a>	y = dreentry_h(x,param)</li><li><a href="dreentry_ia.html" class="code" title="function x = dreentry_ia(x,param)">dreentry_ia</a>	x = dreentry_ia(x,param)</li><li><a href="dreentry_param.html" class="code" title="">dreentry_param</a>	The parameters for re-entry mechanics</li><li><a href="make_dreentry_data.html" class="code" title="">make_dreentry_data</a>	Create data of discrete-time re-entry mechanics</li><li><a href="../../../src/der_check.html" class="code" title="function [D0,D1] = der_check(f,df,index,varargin)">der_check</a>	DER_CHECK  Check derivatives using finite differences</li><li><a href="../../../src/efbf_smooth1.html" class="code" title="function [M,P] = efbf_smooth1(M,P,Y,A,Q,ia,W,aparam,H,R,h,V,hparam,same_p_a,same_p_h)">efbf_smooth1</a>	EFBF_SMOOTH  Extended Forward-Backward Filtering Based Smoother</li><li><a href="../../../src/ekf_predict1.html" class="code" title="function [M,P] = ekf_predict1(M,P,A,Q,a,W,param)">ekf_predict1</a>	EKF_PREDICT  1st order Extended Kalman Filter prediction step</li><li><a href="../../../src/ekf_update1.html" class="code" title="function [M,P,K,IM,S,LH] = ekf_update1(M,P,y,H,R,h,V,param)">ekf_update1</a>	EKF_UPDATE  1st order Extended Kalman Filter update step</li><li><a href="../../../src/erts_smooth1.html" class="code" title="function [M,P,D] = erts_smooth1(M,P,A,Q,a,W,param,same_p)">erts_smooth1</a>	ERTS_SMOOTH1  Extended Rauch-Tung-Striebel smoother</li><li><a href="../../../src/ufbf_smooth1.html" class="code" title="function [M,P] = ufbf_smooth1(M,P,Y,ia,Q,aparam,h,R,hparam,alpha,beta,kappa,mat,same_p_a,same_p_h)">ufbf_smooth1</a>	UFBF_SMOOTH1  Unscented Forward-Backward Filtering Based Smoother</li><li><a href="../../../src/ukf_predict3.html" class="code" title="function [M,P,X,w] = ukf_predict3(M,P,a,Q,R,param,alpha,beta,kappa,mat)">ukf_predict3</a>	UKF_PREDICT2  Augmented form Unscented Kalman Filter prediction step</li><li><a href="../../../src/ukf_update3.html" class="code" title="function [M,P,K,MU,S,LH] = ukf_update3(M,P,Y,h,R,X,w,param,alpha,beta,kappa,mat)">ukf_update3</a>	UKF_UPDATE2 - Augmented form Unscented Kalman Filter update step</li><li><a href="../../../src/urts_smooth1.html" class="code" title="function [M,P,D] = urts_smooth1(M,P,a,Q,param,alpha,beta,kappa,mat,same_p)">urts_smooth1</a>	URTS_SMOOTH1  Additive form Unscented Rauch-Tung-Striebel smoother</li><li><a href="../../../src/urts_smooth2.html" class="code" title="function [M,P,D] = urts_smooth2(M,P,a,Q,param,alpha,beta,kappa,mat,same_p)">urts_smooth2</a>	URTS_SMOOTH2  Augmented form Unscented Rauch-Tung-Striebel smoother</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% Discrete-time reentry demonstration using EKF and UKF.</span>
0002 
0003 <span class="comment">% Copyright (C) 2006 Simo Särkkä</span>
0004 <span class="comment">%               2007 Jouni Hartikainen</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% $Id: ekfs_demo2.m,v 1.5 2006/10/01 22:26:02 ssarkka Exp $</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% This software is distributed under the GNU General Public</span>
0009 <span class="comment">% Licence (version 2 or later); please refer to the file</span>
0010 <span class="comment">% Licence.txt, included with the software, for details.</span>
0011 
0012   <a href="dreentry_param.html" class="code" title="">dreentry_param</a>;
0013   <a href="make_dreentry_data.html" class="code" title="">make_dreentry_data</a>;
0014 
0015   silent = 0;
0016   
0017   <span class="comment">%</span>
0018   <span class="comment">% Estimate with EKF</span>
0019   <span class="comment">%</span>
0020   m = m0;
0021   P = P0;
0022   Q = L*Qc*L'*dt;
0023   func_a  = @<a href="dreentry_a.html" class="code" title="function x = dreentry_a(xw,param)">dreentry_a</a>;
0024   func_ia = @<a href="dreentry_ia.html" class="code" title="function x = dreentry_ia(x,param)">dreentry_ia</a>;
0025   func_da = @<a href="dreentry_da.html" class="code" title="function da = dreentry_da(x,param)">dreentry_da</a>;
0026   func_h  = @<a href="dreentry_h.html" class="code" title="function y = dreentry_h2(x,param)">dreentry_h</a>;
0027   func_dh = @<a href="dreentry_dh.html" class="code" title="function dy = dreentry_dh(x,param)">dreentry_dh</a>;
0028 
0029   MM_EKF = zeros(size(m,1),size(Y,2));
0030   PP_EKF = zeros(size(m,1),size(m,1),size(Y,2));
0031   VV_EKF = zeros(size(m,1),size(Y,2));
0032   EE_EKF = zeros(size(m,1),size(Y,2));
0033   
0034   <a href="../../../src/der_check.html" class="code" title="function [D0,D1] = der_check(f,df,index,varargin)">der_check</a>(func_a, func_da, 1, m0, {dt,b0,H0,Gm0,R0});
0035   <a href="../../../src/der_check.html" class="code" title="function [D0,D1] = der_check(f,df,index,varargin)">der_check</a>(func_h, func_dh, 1, m0, {xr,yr});
0036 
0037   fprintf(<span class="string">'[Running EKF...]\n'</span>); 
0038   <span class="keyword">for</span> k=1:size(Y,2)
0039     [m,P] = <a href="../../../src/ekf_predict1.html" class="code" title="function [M,P] = ekf_predict1(M,P,A,Q,a,W,param)">ekf_predict1</a>(m,P,func_da,Q,func_a,[],{dt,b0,H0,Gm0,R0});
0040     [m,P] = <a href="../../../src/ekf_update1.html" class="code" title="function [M,P,K,IM,S,LH] = ekf_update1(M,P,y,H,R,h,V,param)">ekf_update1</a>(m,P,Y(:,k),func_dh,diag([vr va]),func_h,[],{xr,yr});
0041     MM_EKF(:,k) = m;
0042     PP_EKF(:,:,k) = P;
0043     VV_EKF(:,k) = diag(P);
0044     EE_EKF(:,k) = (X(:,k) - m).^2;
0045   <span class="keyword">end</span>
0046 
0047   <span class="comment">%</span>
0048   <span class="comment">% Calculate RMSE</span>
0049   <span class="comment">%</span>
0050   ekf_rmse = sqrt(mean(sum((X(1:2,:)-MM_EKF(1:2,:)).^2)));
0051   ME_EKF = squeeze(PP_EKF(1,1,:)+PP_EKF(2,2,:));
0052   fprintf(<span class="string">'EKF-RMSE = %.6f [%.6f]\n'</span>,ekf_rmse,sqrt(mean(ME_EKF)));
0053 
0054   <span class="comment">%</span>
0055   <span class="comment">% Smoother 1</span>
0056   <span class="comment">%</span>
0057   [SM_ERTS,SP_ERTS] = <a href="../../../src/erts_smooth1.html" class="code" title="function [M,P,D] = erts_smooth1(M,P,A,Q,a,W,param,same_p)">erts_smooth1</a>(MM_EKF,PP_EKF,func_da,Qc*dt,func_a,L,<span class="keyword">...</span>
0058                           {dt,b0,H0,Gm0,R0});
0059   eks_rmse1 = sqrt(mean(sum((X(1:2,:)-SM_ERTS(1:2,:)).^2)));
0060   ME_ERTS = squeeze(SP_ERTS(1,1,:)+SP_ERTS(2,2,:));
0061   fprintf(<span class="string">'ERTS-RMSE = %.6f [%.6f]\n'</span>,eks_rmse1,sqrt(mean(ME_ERTS)));
0062 
0063   SV_ERTS = zeros(size(m,1),size(Y,2));
0064   SE_ERTS = zeros(size(m,1),size(Y,2));
0065   <span class="keyword">for</span> k=1:size(Y,2)
0066     SV_ERTS(:,k) = diag(SP_ERTS(:,:,k));
0067     SE_ERTS(:,k) = (X(:,k) - SM_ERTS(:,k)).^2;
0068   <span class="keyword">end</span>
0069 
0070   <span class="comment">%</span>
0071   <span class="comment">% Smoother 2</span>
0072   <span class="comment">%</span>
0073   [SM_EFBF,SP_EFBF] = <a href="../../../src/efbf_smooth1.html" class="code" title="function [M,P] = efbf_smooth1(M,P,Y,A,Q,ia,W,aparam,H,R,h,V,hparam,same_p_a,same_p_h)">efbf_smooth1</a>(MM_EKF,PP_EKF,Y,<span class="keyword">...</span>
0074     func_da,Qc*dt,func_ia,L,{dt,b0,H0,Gm0,R0},<span class="keyword">...</span>
0075     func_dh,diag([vr va]),func_h,[],{xr,yr});
0076   
0077   eks_rmse2 = sqrt(mean(sum((X(1:2,:)-SM_EFBF(1:2,:)).^2)));
0078   ME_EFBF = squeeze(SP_EFBF(1,1,:)+SP_EFBF(2,2,:));
0079   fprintf(<span class="string">'EFBF-RMSE = %.6f [%.6f]\n'</span>,eks_rmse2,sqrt(mean(ME_EFBF)));
0080   
0081 
0082   <span class="comment">% UKF</span>
0083   m = m0;
0084   P = P0;
0085   MM_UKF = zeros(size(m,1),size(Y,2));
0086   PP_UKF = zeros(size(m,1),size(m,1),size(Y,2));
0087   VV_UKF = zeros(size(m,1),size(Y,2));
0088   EE_UKF = zeros(size(m,1),size(Y,2));
0089   
0090   fprintf(<span class="string">'[Running UKF...]\n'</span>); 
0091 
0092   <span class="comment">% Filtering with UKF</span>
0093   <span class="keyword">for</span> k=1:size(Y,2)
0094     <span class="comment">% Non-augmented UKF</span>
0095     <span class="comment">%[m,P] = ukf_predict1(m,P,func_a,Q,{dt,b0,H0,Gm0,R0});</span>
0096 
0097     <span class="comment">% Augmented UKF with separate sigma points</span>
0098     <span class="comment">%[m,P] = ukf_predict2(m,P,func_a2,Qc*dt,{dt,b0,H0,Gm0,R0,L});</span>
0099     
0100     <span class="comment">%[m,P] = ukf_update1(m,P,Y(:,k),func_h,diag([vr va]),{xr,yr});</span>
0101     
0102     <span class="comment">% Augmented UKF with same sigma points for predict and update</span>
0103     [m,P,X_s,w] = <a href="../../../src/ukf_predict3.html" class="code" title="function [M,P,X,w] = ukf_predict3(M,P,a,Q,R,param,alpha,beta,kappa,mat)">ukf_predict3</a>(m,P,func_a,Qc*dt,diag([vr va]),d_param);  
0104     [m,P] = <a href="../../../src/ukf_update3.html" class="code" title="function [M,P,K,MU,S,LH] = ukf_update3(M,P,Y,h,R,X,w,param,alpha,beta,kappa,mat)">ukf_update3</a>(m,P,Y(:,k),func_h,diag([vr va]),X_s,w,h_param,h_param);    
0105 
0106     MM_UKF(:,k) = m;
0107     PP_UKF(:,:,k) = P;
0108     VV_UKF(:,k) = diag(P);
0109     EE_UKF(:,k) = (X(:,k) - m).^2;
0110   <span class="keyword">end</span>
0111 
0112   <span class="comment">%</span>
0113   <span class="comment">% Calculate RMSE of UKF</span>
0114   <span class="comment">%</span>
0115   ukf_rmse = sqrt(mean(sum((X(1:2,:)-MM_UKF(1:2,:)).^2)));
0116   ME_UKF = squeeze(PP_UKF(1,1,:)+PP_UKF(2,2,:));
0117   fprintf(<span class="string">'UKF-RMSE = %.6f [%.6f]\n'</span>,ukf_rmse,sqrt(mean(ME_UKF)));
0118   
0119   <span class="comment">%</span>
0120   <span class="comment">% Smoother 1</span>
0121   <span class="comment">%</span>
0122   [SM_URTS,SP_URTS] = <a href="../../../src/urts_smooth1.html" class="code" title="function [M,P,D] = urts_smooth1(M,P,a,Q,param,alpha,beta,kappa,mat,same_p)">urts_smooth1</a>(MM_UKF,PP_UKF,func_a,Q,d_param);
0123   uks_rmse1 = sqrt(mean(sum((X(1:2,:)-SM_URTS(1:2,:)).^2)));
0124   ME_URTS = squeeze(SP_URTS(1,1,:)+SP_URTS(2,2,:));
0125   fprintf(<span class="string">'URTS-RMSE = %.6f [%.6f]\n'</span>,uks_rmse1,sqrt(mean(ME_URTS)));
0126 
0127   SV_URTS = zeros(size(m,1),size(Y,2));
0128   SE_URTS = zeros(size(m,1),size(Y,2));
0129   <span class="keyword">for</span> k=1:size(Y,2)
0130     SV_URTS(:,k) = diag(SP_URTS(:,:,k));
0131     SE_URTS(:,k) = (X(:,k) - SM_URTS(:,k)).^2;
0132   <span class="keyword">end</span>
0133   
0134   [SM_URTSb,SP_URTSb] = <a href="../../../src/urts_smooth2.html" class="code" title="function [M,P,D] = urts_smooth2(M,P,a,Q,param,alpha,beta,kappa,mat,same_p)">urts_smooth2</a>(MM_UKF,PP_UKF,func_a,Qc*dt,d_param);
0135   uks_rmse1b = sqrt(mean(sum((X(1:2,:)-SM_URTSb(1:2,:)).^2)));
0136   ME_URTSb = squeeze(SP_URTSb(1,1,:)+SP_URTSb(2,2,:));
0137   fprintf(<span class="string">'URTS-RMSEb = %.6f [%.6f]\n'</span>,uks_rmse1b,sqrt(mean(ME_URTSb)));
0138 
0139   <span class="comment">%</span>
0140   <span class="comment">% Smoother 2</span>
0141   <span class="comment">%</span>
0142   [SM_UFBF,SP_UFBF] = <a href="../../../src/ufbf_smooth1.html" class="code" title="function [M,P] = ufbf_smooth1(M,P,Y,ia,Q,aparam,h,R,hparam,alpha,beta,kappa,mat,same_p_a,same_p_h)">ufbf_smooth1</a>(MM_UKF,PP_UKF,Y,<span class="keyword">...</span>
0143     func_ia,Qc*dt,d_param,<span class="keyword">...</span>
0144     func_h,diag([vr va]),h_param);
0145   
0146   uks_rmse2 = sqrt(mean(sum((X(1:2,:)-SM_UFBF(1:2,:)).^2)));
0147   ME_UFBF = squeeze(SP_UFBF(1,1,:)+SP_UFBF(2,2,:));
0148   fprintf(<span class="string">'UFBF-RMSE2 = %.6f [%.6f]\n'</span>,uks_rmse2,sqrt(mean(ME_UFBF)));
0149 
0150   <span class="comment">%</span>
0151   <span class="comment">% Plot</span>
0152   <span class="comment">%</span>
0153   <span class="keyword">if</span> ~silent
0154     aa = 0.02*(-1:0.1:4);
0155     cx = R0 * cos(aa);
0156     cy = R0 * sin(aa);
0157     <span class="comment">% Plot EKF estimate</span>
0158     plot(xr,yr,<span class="string">'ko'</span>,cx,cy,<span class="string">'r-'</span>,X(1,:),X(2,:),<span class="string">'g-'</span>,<span class="keyword">...</span>
0159          MM_EKF(1,:),MM_EKF(2,:),<span class="string">'k--'</span>);
0160     legend(<span class="string">'Radar'</span>,<span class="string">'Earth'</span>,<span class="string">'True'</span>,<span class="string">'Estimate'</span>);
0161     disp(<span class="string">'Press any key to proceed.'</span>);
0162     pause;
0163   
0164     <span class="comment">% Error for x_1 with EKF</span>
0165     semilogy(T,EE_EKF(1,:),<span class="string">'g-'</span>,T,VV_EKF(1,:),<span class="string">'b--'</span>,<span class="keyword">...</span>
0166          T,SE_ERTS(1,:),<span class="string">'r-'</span>,T,SV_ERTS(1,:),<span class="string">'k--'</span>);
0167     legend(<span class="string">'EKF-RMSE'</span>,<span class="string">'EKF-STDE'</span>,<span class="keyword">...</span>
0168        <span class="string">'ERTS-RMSE1'</span>,<span class="string">'ERTS-STDE1'</span>);  
0169     title(<span class="string">'RMSE of estimating x_1 with EKF and ERTS'</span>)
0170     disp(<span class="string">'Press any key to proceed.'</span>);
0171     pause  
0172     
0173     <span class="comment">% Error for x_5 with EKF</span>
0174     semilogy(T,EE_EKF(5,:),<span class="string">'g-'</span>,T,VV_EKF(5,:),<span class="string">'b--'</span>,<span class="keyword">...</span>
0175          T,SE_ERTS(5,:),<span class="string">'r-'</span>,T,SV_ERTS(5,:),<span class="string">'k--'</span>);
0176     legend(<span class="string">'EKF-RMSE'</span>,<span class="string">'EKF-STDE'</span>,<span class="keyword">...</span>
0177        <span class="string">'ERTS-RMSE1'</span>,<span class="string">'ERTS-STDE1'</span>);
0178     title(<span class="string">'RMSE of estimating x_5 with EKF and ERTS'</span>)
0179     disp(<span class="string">'Press any key to proceed.'</span>);
0180     pause  
0181     
0182     <span class="comment">% Plot UKF estimate</span>
0183     plot(xr,yr,<span class="string">'ko'</span>,cx,cy,<span class="string">'r-'</span>,X(1,:),X(2,:),<span class="string">'g-'</span>,<span class="keyword">...</span>
0184          MM_UKF(1,:),MM_UKF(2,:),<span class="string">'k--'</span>);
0185     legend(<span class="string">'Radar'</span>,<span class="string">'Earth'</span>,<span class="string">'True'</span>,<span class="string">'Estimate'</span>);
0186     disp(<span class="string">'Press any key to proceed.'</span>);
0187     pause;
0188   
0189     <span class="comment">% Error for x_1 with UKF</span>
0190     semilogy(T,EE_UKF(1,:),<span class="string">'g-'</span>,T,VV_UKF(1,:),<span class="string">'b--'</span>,<span class="keyword">...</span>
0191              T,SE_URTS(1,:),<span class="string">'r-'</span>,T,SV_URTS(1,:),<span class="string">'k--'</span>);
0192     legend(<span class="string">'UKF-RMSE'</span>,<span class="string">'UKF-STDE'</span>,<span class="string">'URTS-RMSE'</span>,<span class="string">'URTS-STDE'</span>);
0193     title(<span class="string">'RMSE of estimating x_1 with UKF and URTS'</span>)    
0194     disp(<span class="string">'Press any key to proceed.'</span>);
0195     pause;
0196   
0197     <span class="comment">% Error for x_5 with UKF</span>
0198     semilogy(T,EE_UKF(5,:),<span class="string">'g-'</span>,T,VV_UKF(5,:),<span class="string">'b--'</span>,<span class="keyword">...</span>
0199              T,SE_URTS(5,:),<span class="string">'r-'</span>,T,SV_URTS(5,:),<span class="string">'k--'</span>);
0200     legend(<span class="string">'UKF-RMSE'</span>,<span class="string">'UKF-STDE'</span>,<span class="string">'URTS-RMSE'</span>,<span class="string">'URTS-STDE'</span>);
0201     title(<span class="string">'RMSE of estimating x_5 with UKF and URTS'</span>)
0202   <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 07-Jun-2007 14:54:42 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>